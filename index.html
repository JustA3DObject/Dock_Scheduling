<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Berth Allocation AI - Visakhapatnam Port Authority</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-light: #f4f7fa;
            --bg-dark: #111827;
            --card-light: #ffffff;
            --card-dark: rgba(31, 41, 55, 0.85);
            --border-light: #e5e7eb;
            --border-dark: #374151;
            --text-light: #1f2937;
            --text-dark: #f9fafb;
            --text-muted-light: #4b5563;
            --text-muted-dark: #d1d5db;
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-light);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .dark body {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }
        
        .background-blur {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            animation: animate-glow 25s ease-in-out infinite alternate;
        }
        
        @keyframes animate-glow {
            from {
                background: radial-gradient(circle at 10% 20%, rgba(96, 165, 250, 0.2), transparent 40%),
                            radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.2), transparent 40%);
            }
            to {
                background: radial-gradient(circle at 80% 15%, rgba(96, 165, 250, 0.2), transparent 40%),
                            radial-gradient(circle at 20% 85%, rgba(139, 92, 246, 0.2), transparent 40%);
            }
        }

        .glass-card {
            background: var(--card-light);
            border: 1px solid var(--border-light);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        }
        .dark .glass-card {
            background: var(--card-dark);
            border: 1px solid var(--border-dark);
        }
        .glass-card-interactive:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.15);
        }
        .date-btn.active {
            background-color: #4f46e5;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 14px 0 rgba(79, 70, 229, 0.39);
        }
        .primary-btn {
            background-color: #4f46e5;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 14px 0 rgba(79, 70, 229, 0.3);
        }
        .primary-btn:hover {
            background-color: #4338ca;
            box-shadow: 0 6px 20px 0 rgba(79, 70, 229, 0.35);
            transform: translateY(-2px);
        }
        .modal-hidden {
            display: none;
            opacity: 0;
        }
        
        /* Improved contrast for light mode */
        .theme-light .text-slate-500 {
            color: var(--text-muted-light);
        }
        .theme-light .text-slate-400 {
            color: #6b7280;
        }
        .theme-light .bg-slate-200 {
            background-color: #e5e7eb;
        }
        .theme-light .bg-slate-100 {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="min-h-screen">

    <div class="background-blur"></div>

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="flex justify-between items-center mb-10">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-indigo-600 rounded-lg flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-1.414 1.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-1.414-1.414A1 1 0 006.586 13H4" />
                    </svg>
                </div>
                <div>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-slate-900 dark:text-white">Berth Allocation AI</h1>
                    <p class="text-base text-slate-700 dark:text-slate-300">Visakhapatnam Port Authority</p>
                </div>
            </div>
            <button id="theme-toggle" class="p-2 rounded-full text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-800 transition-colors">
                <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                <svg id="theme-icon-dark" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
            </button>
        </header>

        <div class="flex flex-col lg:flex-row gap-8">
            <aside class="lg:w-1/3 xl:w-1/4 space-y-6">
                <!-- Real-time Data Controls Card -->
                <div class="glass-card p-6 rounded-2xl">
                    <h2 class="text-xl font-bold mb-4 border-b border-slate-300 dark:border-slate-700 pb-2">Real-time Data</h2>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-slate-600 dark:text-slate-400">Last Updated:</span>
                            <span id="last-updated-time" class="text-sm font-medium text-slate-800 dark:text-slate-200">--:--:--</span>
                        </div>
                        <button id="refreshRealTimeData" class="primary-btn w-full text-white font-bold py-2 px-4 rounded-lg transition duration-300 flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                            Refresh Real-time Data
                        </button>
                        <div class="pt-2 border-t border-slate-200 dark:border-slate-700">
                            <div class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400">
                                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                <span>Real-time data integration ready</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weather Information Card -->
                <div class="glass-card p-6 rounded-2xl">
                    <h2 class="text-xl font-bold mb-4 border-b border-slate-300 dark:border-slate-700 pb-2">Weather Conditions</h2>
                    <div id="weather-content" class="space-y-3">
                        <div class="text-center py-8">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"></div>
                            <p class="text-sm text-slate-500 dark:text-slate-400 mt-2">Loading weather data...</p>
                        </div>
                    </div>
                </div>
                
                <div class="glass-card p-6 rounded-2xl">
                    <h2 class="text-xl font-bold mb-4 border-b border-slate-300 dark:border-slate-700 pb-2">Controls</h2>
                    
                    <div class="mb-5">
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Simulation Day</label>
                        <div class="flex w-full bg-slate-200 dark:bg-slate-800 rounded-lg p-1 space-x-1">
                            <button id="day27Btn" class="date-btn w-full py-2 px-2 rounded-md text-sm font-medium text-slate-700 dark:text-slate-300 transition-all">Sep 27</button>
                            <button id="day28Btn" class="date-btn w-full py-2 px-2 rounded-md text-sm font-medium text-slate-700 dark:text-slate-300 transition-all">Sep 28</button>
                            <button id="day29Btn" class="date-btn w-full py-2 px-2 rounded-md text-sm font-medium text-slate-700 dark:text-slate-300 transition-all">Sep 29</button>
                            <button id="day30Btn" class="date-btn w-full py-2 px-2 rounded-md text-sm font-medium text-slate-700 dark:text-slate-300 transition-all">Sep 30</button>
                            <button id="day1Btn" class="date-btn w-full py-2 px-2 rounded-md text-sm font-medium text-slate-700 dark:text-slate-300 transition-all">Oct 1</button>
                            <button id="day2Btn" class="date-btn w-full py-2 px-2 rounded-md text-sm font-medium text-slate-700 dark:text-slate-300 transition-all">Oct 2</button>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <button id="resetDataBtn" class="w-full bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-semibold py-3 px-4 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition duration-300">
                            Reset Day
                        </button>
                        <button id="runOptimizationBtn" class="primary-btn w-full text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-lg text-lg flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd" />
                            </svg>
                            Run Daily Simulation
                        </button>
                        <button id="stopSimulationBtn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-lg text-lg flex items-center justify-center gap-2 hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd" />
                            </svg>
                            Stop Simulation
                        </button>
                    </div>
                </div>

                <div class="glass-card p-6 rounded-2xl">
                    <h2 class="text-xl font-bold mb-4 border-b border-slate-300 dark:border-slate-700 pb-2">Port Activity Log</h2>
                    <div id="activity-log" class="space-y-3 max-h-96 overflow-y-auto pr-2"></div>
                </div>

                <div class="glass-card p-6 rounded-2xl">
                    <h2 class="text-xl font-bold mb-4 border-b border-slate-300 dark:border-slate-700 pb-2">Performance Analytics</h2>
                    <div id="analytics-content" class="space-y-4"></div>
                </div>

                <div class="glass-card p-6 rounded-2xl">
                    <h2 class="text-xl font-bold mb-4 border-b border-slate-300 dark:border-slate-700 pb-2">Vessels Awaiting Berthing</h2>
                    <div id="waiting-vessels-list" class="space-y-3 max-h-96 overflow-y-auto pr-2"></div>
                </div>
            </aside>

            <main class="lg:w-2/3 xl:w-3/4 space-y-8">
                <!-- Real-time Vessels Overview Card -->
                <div class="glass-card p-6 rounded-2xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100">Real-time Port Overview</h2>
                        <div class="flex gap-2">
                            <span class="px-3 py-1 bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300 text-sm font-medium rounded-full">
                                Live Data
                            </span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 rounded-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm text-slate-600 dark:text-slate-400">Vessels in Port</p>
                                    <p id="vessels-in-port" class="text-2xl font-bold text-slate-800 dark:text-slate-100">--</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400 rounded-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm text-slate-600 dark:text-slate-400">Expected Arrivals (24h)</p>
                                    <p id="expected-arrivals" class="text-2xl font-bold text-slate-800 dark:text-slate-100">--</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400 rounded-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm text-slate-600 dark:text-slate-400">Recent Departures</p>
                                    <p id="recent-departures" class="text-2xl font-bold text-slate-800 dark:text-slate-100">--</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Real-time Vessels Table -->
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-100 mb-4">Current Port Activity</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wider">Vessel</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wider">Status</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wider">Size</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wider">Time</th>
                                    </tr>
                                </thead>
                                <tbody id="real-time-vessels-body" class="divide-y divide-slate-200 dark:divide-slate-700">
                                    <tr>
                                        <td colspan="4" class="px-4 py-8 text-center text-slate-500 dark:text-slate-400">
                                            Loading real-time vessel data...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                 <div class="glass-card p-6 rounded-2xl">
                     <h2 class="text-2xl font-bold mb-6 text-center text-slate-800 dark:text-slate-100">Operations Dashboard: Berth Status</h2>
                     <div id="berth-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"></div>
                 </div>

                <div class="glass-card p-6 rounded-2xl">
                    <h2 class="text-2xl font-bold mb-6 text-center text-slate-800 dark:text-slate-100">Optimal Berth Allotment Plan</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead>
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wider">Vessel Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wider">Assigned Berth</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wider">Arrival Time</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wider">Berthing Time</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wider">Wait Time (Cost)</th>
                                </tr>
                            </thead>
                            <tbody id="allotment-plan-body"></tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Berth History Modal -->
    <div id="berth-history-modal" class="modal-hidden fixed inset-0 z-50 flex items-center justify-center p-4 transition-opacity duration-300">
        <div id="modal-backdrop" class="fixed inset-0 bg-black/50 backdrop-blur-sm"></div>
        <div class="glass-card w-full max-w-2xl rounded-2xl z-10 transform scale-95 transition-transform duration-300">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4 pb-4 border-b border-slate-300 dark:border-slate-700">
                    <h3 id="modal-title" class="text-2xl font-bold text-slate-800 dark:text-slate-100">Berth Service History</h3>
                    <button id="modal-close-btn" class="p-2 rounded-full text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <ul id="modal-history-list" class="space-y-3 max-h-[60vh] overflow-y-auto pr-2">
                    <!-- History items will be injected here -->
                </ul>
            </div>
        </div>
    </div>

    <script>
        //  THEME TOGGLE SCRIPT 
        const themeToggle = document.getElementById('theme-toggle');
        const themeIconLight = document.getElementById('theme-icon-light');
        const themeIconDark = document.getElementById('theme-icon-dark');

        // Add theme class to body for better contrast control
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            document.body.classList.add('theme-dark');
            document.body.classList.remove('theme-light');
            themeIconLight.classList.remove('hidden');
        } else {
            document.documentElement.classList.remove('dark');
            document.body.classList.add('theme-light');
            document.body.classList.remove('theme-dark');
            themeIconDark.classList.remove('hidden');
        }

        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            
            if (isDark) {
                document.body.classList.add('theme-dark');
                document.body.classList.remove('theme-light');
            } else {
                document.body.classList.add('theme-light');
                document.body.classList.remove('theme-dark');
            }
            
            themeIconLight.classList.toggle('hidden', !isDark);
            themeIconDark.classList.toggle('hidden', isDark);
        });
        
        //  SIMULATION DATA 
        const berthSpecifications = { 
            'EQ-1': { loa: 240, draft: 14.5 }, 'EQ-3': { loa: 240, draft: 14.5 }, 'EQ-4': { loa: 240, draft: 14.5 }, 
            'EQ-5': { loa: 240, draft: 11.5 }, 'EQ-6': { loa: 240, draft: 11.5 }, 'EQ-7': { loa: 240, draft: 14.5 }, 
            'EQ-8': { loa: 235, draft: 14.5 }, 'EQ-9': { loa: 235, draft: 14.5 }, 'EQ-10': { loa: 160, draft: 11 }, 
            'WQ-1': { loa: 240, draft: 11 }, 'WQ-2': { loa: 240, draft: 13.5 }, 'WQ-3': { loa: 240, draft: 13.5 }, 
            'WQ-4': { loa: 240, draft: 11.5 }, 'WQ-5': { loa: 240, draft: 11.5 }, 'WQ-6': { loa: 230, draft: 14.5 }, 
            'WQ-7': { loa: 240, draft: 14.5 }, 'WQ-8': { loa: 240, draft: 14.5 }, 'FB': { loa: 200, draft: 10.06 }, 
            'OR-1': { loa: 195, draft: 11 }, 'OR-2': { loa: 195, draft: 11 }, 'OR-3': { loa: 160, draft: 10.5 }, 
            'OSTT': { loa: 280, draft: 17 }, 'LPG': { loa: 230, draft: 14 }, 'OB-1': { loa: 300, draft: 16.5 }, 
            'OB-2': { loa: 300, draft: 17 }, 'C.TERMIN': { loa: 300, draft: 8.5 }, 'VGCB': { loa: 300, draft: 18.1 }, 
            'CB-1': { loa: 390, draft: 16 }, 'CB-2': { loa: 390, draft: 16 }, 'CB-3': { loa: 390, draft: 16 }, 
            'CB-4': { loa: 390, draft: 16 }, 'EQ-1A': { loa: 240, draft: 14.5 }, 'WQ-1RE': { loa: 240, draft: 11 }, 
            'SPM': { loa: 400, draft: 22 } 
        };
        
        const portDataByDay = { 
            27: { 
                occupancy: [
                    { berthName: 'OB-2', vesselName: 'm.v COMMON HORIZON' }, { berthName: 'C.TERMIN', vesselName: 'm.v SAFINAH' }, 
                    { berthName: 'VGCB', vesselName: 'm.v THEODORE JR' }, { berthName: 'OSTT', vesselName: 'm.t SWARNA KRISHNA' }, 
                    { berthName: 'CB-3', vesselName: 'm.v PAC SCHEDAR' }, { berthName: 'EQ-1', vesselName: 'm.v SARAH OLDENDORFF' }, 
                    { berthName: 'EQ-3', vesselName: 'm.v HERMES' }, { berthName: 'EQ-4', vesselName: 'm.v PIONEER KIRA' }, 
                    { berthName: 'EQ-6', vesselName: 'm.v KIRAN AMERICA' }, { berthName: 'EQ-9', vesselName: 'm.v NEW GALAXY' }, 
                    { berthName: 'WQ-1', vesselName: 'm.v FLAG EVI' }, { berthName: 'WQ-2', vesselName: 'm.v ENDEAVOR' }, 
                    { berthName: 'WQ-3', vesselName: 'm.v SUNNY FORTUNE' }, { berthName: 'WQ-4', vesselName: 'm.v JIN HAI ZHENG' }, 
                    { berthName: 'WQ-5', vesselName: 'm.v YIN NENG' }, { berthName: 'WQ-6', vesselName: 'm.v JABAL SAMHAN' }, 
                    { berthName: 'WQ-7', vesselName: 'm.v ILIA' }, { berthName: 'WQ-8', vesselName: 'm.v STAR HAMBURG' }, 
                    { berthName: 'OR-1', vesselName: 'm.t ZHONG CHI' }, { berthName: 'FB', vesselName: 'm.v AMOY PROGRESS' }
                ], 
                waiting: [
                    { name: 'm.v JAL KAMADHENU', tonnes: 75000, arrivalStr: '27-Sep-2025 08:00' }, 
                    { name: 'm.t ASPHALT EXPRSS', tonnes: 6000, arrivalStr: '27-Sep-2025 05:22' }, 
                    { name: 'm.v MONA LISA', tonnes: 32000, arrivalStr: '27-Sep-2025 02:50' }, 
                    { name: 'm.v CHIPOL CHANGAN', tonnes: 13000, arrivalStr: '27-Sep-2025 15:00' }, 
                    { name: 'm.t DESH VISHAL', tonnes: 261261, arrivalStr: '27-Sep-2025 15:00' }, 
                    { name: 'm.t A R G', tonnes: 9000, arrivalStr: '27-Sep-2025 18:00' }
                ] 
            }, 
            28: { 
                occupancy: [
                    { berthName: 'OB-1', vesselName: 'm.v JAL KAMADHENU' }, { berthName: 'OB-2', vesselName: 'm.v COMMON HORIZON' }, 
                    { berthName: 'C.TERMIN', vesselName: 'm.v SAFINAH' }, { berthName: 'VGCB', vesselName: 'm.v RED ORCHID' }, 
                    { berthName: 'OSTT', vesselName: 'm.t SWARNA KRISHNA' }, { berthName: 'EQ-1', vesselName: 'm.v SARAH OLDENDORFF' }, 
                    { berthName: 'EQ-3', vesselName: 'm.v HERMES' }, { berthName: 'EQ-4', vesselName: 'm.v PIONEER KIRA' }, 
                    { berthName: 'EQ-6', vesselName: 'm.v KIRAN AMERICA' }, { berthName: 'WQ-1', vesselName: 'm.v FLAG EVI' }, 
                    { berthName: 'WQ-2', vesselName: 'm.v ENDEAVOR' }, { berthName: 'WQ-3', vesselName: 'm.v SUNNY FORTUNE' }, 
                    { berthName: 'WQ-4', vesselName: 'm.v JIN HAI ZHENG' }, { berthName: 'WQ-5', vesselName: 'm.v YIN NENG' }, 
                    { berthName: 'WQ-6', vesselName: 'm.v JABAL SAMHAN' }, { berthName: 'WQ-7', vesselName: 'm.v ILIA' }, 
                    { berthName: 'WQ-8', vesselName: 'm.v STAR HAMBURG' }, { berthName: 'OR-1', vesselName: 'm.t ZHONG CHI' }, 
                    { berthName: 'OR-3', vesselName: 'm.t ASPHALT EXPRESS' }, { berthName: 'FB', vesselName: 'm.v AMOY PROGRESS' }
                ], 
                waiting: [
                    { name: 'm.t ALPINE LIGHT', tonnes: 34650, arrivalStr: '28-Sep-2025 01:45' }, 
                    { name: 'm.v PAC CAPELLA', tonnes: 8240, arrivalStr: '28-Sep-2025 05:56' }, 
                    { name: 'm.t AL SHAFFIAH', tonnes: 11923, arrivalStr: '28-Sep-2025 10:00' }, 
                    { name: 'm.v WAN HAI 367', tonnes: 21500, arrivalStr: '28-Sep-2025 09:00' }, 
                    { name: 'm.v GSL MELINA', tonnes: 24000, arrivalStr: '28-Sep-2025 15:00' }
                ] 
            }, 
            29: { 
                occupancy: [
                    { berthName: 'OB-1', vesselName: 'm.v JAL KAMADHENU' }, { berthName: 'C.TERMIN', vesselName: 'm.v SAFINAH' }, 
                    { berthName: 'VGCB', vesselName: 'm.v RED ORCHID' }, { berthName: 'LPG', vesselName: 'LPG/C. GAS VIRGO' }, 
                    { berthName: 'CB-2', vesselName: 'm.v WAN HAI 367' }, { berthName: 'CB-3', vesselName: 'm.v GSL MELINA' }, 
                    { berthName: 'EQ-1', vesselName: 'm.v SARAH OLDENDORFF' }, { berthName: 'EQ-3', vesselName: 'm.v HERMES' }, 
                    { berthName: 'EQ-4', vesselName: 'm.v PIONEER KIRA' }, { berthName: 'EQ-6', vesselName: 'm.v KIRAN AMERICA' }, 
                    { berthName: 'WQ-1', vesselName: 'm.v FLAG EVI' }, { berthName: 'WQ-2', vesselName: 'm.v ENDEAVOR' }, 
                    { berthName: 'WQ-3', vesselName: 'm.v NORD UTOPIA' }, { berthName: 'WQ-4', vesselName: 'm.v CHIPOL CHANGAN' }, 
                    { berthName: 'WQ-5', vesselName: 'm.v INLACO EXPRESS' }, { berthName: 'WQ-6', vesselName: 'm.v JABAL SAMHAN' }, 
                    { berthName: 'WQ-7', vesselName: 'm.v ILIA' }, { berthName: 'WQ-8', vesselName: 'm.v STAR HAMBURG' }, 
                    { berthName: 'OR-1', vesselName: 'm.t ALPINE LIGHT' }, { berthName: 'OR-3', vesselName: 'm.t A R G' }
                ], 
                waiting: [
                    { name: 'm.v GCL GANGA', tonnes: 105000, arrivalStr: '29-Sep-2025 15:00' }, 
                    { name: 'm.t GLBS MAGIC', tonnes: 54390, arrivalStr: '29-Sep-2025 00:13' }, 
                    { name: 'm.v SANTA IRINI [GLP]', tonnes: 32872, arrivalStr: '29-Sep-2025 18:00' }, 
                    { name: 'm.v HAPPY HERO', tonnes: 8233, arrivalStr: '29-Sep-2025 12:00' }, 
                    { name: 'm.v CONTSHIP ANA II', tonnes: 18000, arrivalStr: '29-Sep-2025 10:00' }, 
                    { name: 'm.t STI DUCHESSA', tonnes: 6797, arrivalStr: '29-Sep-2025 19:00' }, 
                    { name: 'LPG/C SEARAMBLER', tonnes: 5000, arrivalStr: '29-Sep-2025 11:30' }
                ] 
            }, 
            30: { 
                occupancy: [
                    { berthName: 'OB-1', vesselName: 'm.v JAL KAMADHENU' }, { berthName: 'C.TERMIN', vesselName: 'm.v SAFINAH' }, 
                    { berthName: 'VGCB', vesselName: 'm.v RED ORCHID' }, { berthName: 'SPM', vesselName: 'm.t DESH VISHAL' }, 
                    { berthName: 'LPG', vesselName: 'LPG/C. GAS VIRGO' }, { berthName: 'CB-2', vesselName: 'm.v CONTSHIP ANA II' }, 
                    { berthName: 'EQ-1', vesselName: 'm.v SARAH OLDENDORFF' }, { berthName: 'EQ-3', vesselName: 'm.y BOS BROOK' }, 
                    { berthName: 'EQ-4', vesselName: 'm.v PIONEER KIRA' }, { berthName: 'EQ-6', vesselName: 'm.v KIRAN AMERICA' }, 
                    { berthName: 'WQ-1RE', vesselName: 'm.v HAPPY HERO' }, { berthName: 'WQ-1', vesselName: 'm.v RIO RITA' }, 
                    { berthName: 'WQ-2', vesselName: 'm.v PAC CAPELLA' }, { berthName: 'WQ-3', vesselName: 'm.v NORD UTOPIA' }, 
                    { berthName: 'WQ-4', vesselName: 'm.v CHIPOL CHANGAN' }, { berthName: 'WQ-5', vesselName: 'm.v INLACO EXPRESS' }, 
                    { berthName: 'WQ-6', vesselName: 'm.v JABAL SAMHAN' }, { berthName: 'WQ-7', vesselName: 'm.v ILIA' }, 
                    { berthName: 'WQ-8', vesselName: 'm.v STAR HAMBURG' }, { berthName: 'OR-1', vesselName: 'm.t ALPINE LIGHT' }, 
                    { berthName: 'FB', vesselName: 'LPG/C SEARAMBLER' }
                ], 
                waiting: [
                    { name: 'm.v GCL GANGA', tonnes: 105000, arrivalStr: '29-Sep-2025 12:08' }, 
                    { name: 'm.v ABRAM SCHULTE', tonnes: 55000, arrivalStr: '30-Sep-2025 12:00' }, 
                    { name: 'm.v MONA LISA', tonnes: 32000, arrivalStr: '27-Sep-2025 02:50' }, 
                    { name: 'm.t GLBS MAGIC', tonnes: 54390, arrivalStr: '29-Sep-2025 00:13' }, 
                    { name: 'm.v SANTA IRINI [GLP]', tonnes: 32872, arrivalStr: '30-Sep-2025 13:00' }, 
                    { name: 'm.t AL SHAFFIAH', tonnes: 11923, arrivalStr: '28-Sep-2025 17:41' }, 
                    { name: 'm.v CL ANZI HE', tonnes: 55900, arrivalStr: '30-Sep-2025 10:00' }, 
                    { name: 'LPG/C GREEN SANVI', tonnes: 25900, arrivalStr: '26-Sep-2025 06:28' }, 
                    { name: 'm.t STI DUCHESSA', tonnes: 6797, arrivalStr: '29-Sep-2025 07:52' }
                ] 
            }, 
            1: { 
                occupancy: [
                    { berthName: 'C.TERMIN', vesselName: 'm.v SAFINAH' }, { berthName: 'VGCB', vesselName: 'm.v MONA LISA' }, 
                    { berthName: 'SPM', vesselName: 'm.t DESH VISHAL' }, { berthName: 'CB-1', vesselName: 'm.v SSL SABARIMALAI' }, 
                    { berthName: 'EQ-1A', vesselName: 'm.v SANTA IRINI' }, { berthName: 'EQ-1', vesselName: 'm.v GLBS MAGIC' }, 
                    { berthName: 'EQ-3', vesselName: 'm.v BOS BROOK' }, { berthName: 'EQ-4', vesselName: 'm.v RACOON' }, 
                    { berthName: 'EQ-6', vesselName: 'm.v KIRAN AMERICA' }, { berthName: 'WQ-1RE', vesselName: 'm.v HAPPY HERO' }, 
                    { berthName: 'WQ-1', vesselName: 'm.v RIO RITA' }, { berthName: 'WQ-2', vesselName: 'm.v PAC CAPELLA' }, 
                    { berthName: 'WQ-3', vesselName: 'm.v NORD UTOPIA' }, { berthName: 'WQ-4', vesselName: 'm.v CHIPOL CHANGAN' }, 
                    { berthName: 'WQ-6', vesselName: 'm.v JABAL SAMHAN' }, { berthName: 'WQ-7', vesselName: 'm.v ILIA' }, 
                    { berthName: 'WQ-8', vesselName: 'm.v STAR HAMBURG' }, { berthName: 'OR-3', vesselName: 'm.t AL SHAFFIAH' }
                ], 
                waiting: [
                    { name: 'm.v GCL GANGA', tonnes: 105000, arrivalStr: '29-Sep-2025 12:08' }, 
                    { name: 'm.v ABRAM SCHULTE', tonnes: 55000, arrivalStr: '30-Sep-2025 10:21' }, 
                    { name: 'm.v STARLIGHT', tonnes: 34037, arrivalStr: '02-Sep-2025 16:28' }, 
                    { name: 'm.t HELEN M', tonnes: 34650, arrivalStr: '30-Sep-2025 18:57' }, 
                    { name: 'm.t LOURDES', tonnes: 6000, arrivalStr: '01-Oct-2025 03:22' }, 
                    { name: 'LPG/C GAS QUANTUM', tonnes: 5000, arrivalStr: '01-Oct-2025 13:00' }, 
                    { name: 'm.v PORTO LIMNIONI [GLP]', tonnes: 44000, arrivalStr: '01-Oct-2025 10:00' }, 
                    { name: 'm.v GEOPRIDE', tonnes: 46176, arrivalStr: '01-Oct-2025 15:00' }, 
                    { name: 'm.y CL ANZI HE', tonnes: 55900, arrivalStr: '01-Oct-2025 10:00' }, 
                    { name: 'm.v VAN INFINITY', tonnes: 19000, arrivalStr: '01-Oct-2025 21:30' }, 
                    { name: 'm..v XIN TIAN JIN', tonnes: 35100, arrivalStr: '01-Oct-2025 09:30' }, 
                    { name: 'LPG/C GREEN SANVI', tonnes: 25900, arrivalStr: '26-Sep-2025 06:28' }, 
                    { name: 'm.t STI DUCHESSA', tonnes: 6797, arrivalStr: '29-Sep-2025 07:52' }, 
                    { name: 'LPG/C SHIVALIK', tonnes: 30000, arrivalStr: '02-Sep-2025 04:00' }
                ] 
            }, 
            2: { 
                occupancy: [
                    { berthName: 'OB-2', vesselName: 'm.v GCL GANGA' }, { berthName: 'VGCB', vesselName: 'm.v CL ANZI HE' }, 
                    { berthName: 'CB-3', vesselName: 'm.v XIN TIAN JIN' }, { berthName: 'EQ-1A', vesselName: 'm.v SANTA IRINI' }, 
                    { berthName: 'EQ-1', vesselName: 'm.v GLBS MAGIC' }, { berthName: 'EQ-3', vesselName: 'm.v BOS BROOK' }, 
                    { berthName: 'EQ-4', vesselName: 'm.v RACOON' }, { berthName: 'EQ-8', vesselName: 'm.v GEOPRIDE' }, 
                    { berthName: 'WQ-1RE', vesselName: 'm.v HAPPY HERO' }, { berthName: 'WQ-1', vesselName: 'm.v RIO RITA' }, 
                    { berthName: 'WQ-2', vesselName: 'm.v PAC CAPELLA' }, { berthName: 'WQ-3', vesselName: 'm.v NORD UTOPIA' }, 
                    { berthName: 'WQ-6', vesselName: 'm.v JABAL SAMHAN' }, { berthName: 'WQ-7', vesselName: 'm.v ILIA' }, 
                    { berthName: 'OR-1', vesselName: 'm.t STI DUCHESSA' }
                ], 
                waiting: [
                    { name: 'm.v ABRAM SCHULTE', tonnes: 55000, arrivalStr: '30-Sep-2025 10:21' }, 
                    { name: 'm.v AN HAI STAR', tonnes: 4230, arrivalStr: '02-Oct-2025 10:00' }, 
                    { name: 'm.v ISE', tonnes: 18000, arrivalStr: '02-Oct-2025 13:00' }, 
                    { name: 'm.v STARLIGHT', tonnes: 34037, arrivalStr: '02-Sep-2025 16:28' }, 
                    { name: 'm.v SAFINAH', tonnes: 29040, arrivalStr: '05-Aug-2025 17:48' }, 
                    { name: 'm.t HELEN M', tonnes: 34650, arrivalStr: '30-Sep-2025 18:57' }, 
                    { name: 'LPG/C GAS QUANTUM', tonnes: 5000, arrivalStr: '02-Oct-2025 08:00' }, 
                    { name: 'm.v PORTO LIMNIONI [GLP]', tonnes: 44000, arrivalStr: '01-Oct-2025 09:03' }, 
                    { name: 'm.y RAON TERESA', tonnes: 8258, arrivalStr: '02-Oct-2025 05:23' }, 
                    { name: 'm.v VAN INFINITY', tonnes: 19000, arrivalStr: '02-Oct-2025 08:00' }, 
                    { name: 'm.v SSL THAMIRABARANI', tonnes: 8500, arrivalStr: '04-Sep-2025 04:00' }, 
                    { name: 'LPG/C GREEN SANVI', tonnes: 25900, arrivalStr: '26-Sep-2025 06:28' }, 
                    { name: 'LPG/C. SHIVALIK', tonnes: 30000, arrivalStr: '02-Sep-2025 04:30' }
                ] 
            } 
        };
        
        const allBerthNames = [...new Set(Object.keys(berthSpecifications))];

        //  SIMULATION LOGIC 
        let berths = [];
        let vessels = [];
        let simulationTime;
        let currentDay = 29;
        let berthHistory = {};
        let activityLog = [];
        let simulationInterval = null;
        let totalWaitTimeForDay = 0;
        let totalTimeOptimizedForDay = 0;
        let dailyStats = {
            totalWaitTime: 0,
            totalTimeOptimized: 0,
            vesselsBerthed: 0,
            vesselsWaiting: 0
        };

        // Track ongoing vessel services across days
        let ongoingVesselServices = {};

        // ===== REAL-TIME DATA INTEGRATION =====
        
        // Configuration
        const REAL_TIME_UPDATE_INTERVAL = 300000; // 5 minutes
        const WEATHER_UPDATE_INTERVAL = 1800000; // 30 minutes
        
        // API Configuration (You'll need to obtain these keys)
        const OPENWEATHER_API_KEY = 'YOUR_OPENWEATHER_API_KEY'; // Get from https://openweathermap.org/api
        const VESSELFINDER_API_KEY = 'YOUR_VESSELFINDER_API_KEY'; // Get from https://api.vesselfinder.com/
        
        // Real-time data state
        let realTimeData = {
            vesselsInPort: [],
            expectedArrivals: [],
            recentDepartures: [],
            weatherData: null,
            lastUpdate: null
        };

        // Initialize real-time data integration
        function initRealTimeIntegration() {
            // Load initial data
            loadRealTimeData();
            
            // Set up periodic updates
            setInterval(loadRealTimeData, REAL_TIME_UPDATE_INTERVAL);
            setInterval(loadWeatherData, WEATHER_UPDATE_INTERVAL);
            
            // Set up manual refresh button
            document.getElementById('refreshRealTimeData').addEventListener('click', loadRealTimeData);
        }

        // Load all real-time data
        async function loadRealTimeData() {
            try {
                updateLastUpdatedTime();
                await loadWeatherData();
                await loadVesselData();
                renderRealTimeData();
            } catch (error) {
                console.error('Error loading real-time data:', error);
                showDataError('Failed to load real-time data');
            }
        }

        // Load weather data from OpenWeatherMap API
        async function loadWeatherData() {
            // For Visakhapatnam coordinates
            const lat = 17.6871;
            const lon = 83.3007;
            
            // Using demo data since API key is required
            // In production, you would use:
            // const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${OPENWEATHER_API_KEY}&units=metric`);
            
            // Demo weather data (replace with actual API call)
            realTimeData.weatherData = {
                temperature: 28,
                humidity: 75,
                description: 'Partly cloudy',
                windSpeed: 12,
                pressure: 1013,
                icon: '02d'
            };
            
            renderWeatherData();
        }

        // Load vessel data (using demo data - replace with actual VesselFinder API calls)
        async function loadVesselData() {
            // Demo data based on VesselFinder structure
            realTimeData.vesselsInPort = [
                { name: 'MV Ocean Carrier', status: 'In Port', size: '228×32m', time: '15:33', type: 'Container' },
                { name: 'SSL Sabarimalai', status: 'In Port', size: '225×37m', time: '15:42', type: 'Bulk Carrier' },
                { name: 'MV Santa Irini', status: 'In Port', size: '225×36m', time: '15:37', type: 'General Cargo' }
            ];
            
            realTimeData.expectedArrivals = [
                { name: 'MV Pacific Star', eta: 'Oct 3, 04:00', size: '175×28m', type: 'Container' },
                { name: 'MV Northern Light', eta: 'Oct 3, 05:30', size: '228×32m', type: 'Bulk Carrier' }
            ];
            
            realTimeData.recentDepartures = [
                { name: 'MV Sunny Fortune', time: 'Oct 2, 17:50', size: '199×32m', type: 'Container' },
                { name: 'MV Endeavor', time: 'Oct 2, 13:59', size: '280×40m', type: 'Tanker' }
            ];
        }

        // Render real-time data to the UI
        function renderRealTimeData() {
            // Update summary cards
            document.getElementById('vessels-in-port').textContent = realTimeData.vesselsInPort.length;
            document.getElementById('expected-arrivals').textContent = realTimeData.expectedArrivals.length;
            document.getElementById('recent-departures').textContent = realTimeData.recentDepartures.length;
            
            // Render vessels table
            const vesselsBody = document.getElementById('real-time-vessels-body');
            vesselsBody.innerHTML = '';
            
            realTimeData.vesselsInPort.forEach(vessel => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-slate-50 dark:hover:bg-slate-800/50';
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap">
                        <div class="font-medium text-slate-800 dark:text-slate-100">${vessel.name}</div>
                        <div class="text-xs text-slate-500 dark:text-slate-400">${vessel.type}</div>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-medium bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300 rounded-full">
                            ${vessel.status}
                        </span>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300">
                        ${vessel.size}
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300">
                        ${vessel.time}
                    </td>
                `;
                vesselsBody.appendChild(row);
            });
        }

        // Render weather data
        function renderWeatherData() {
            const weatherContent = document.getElementById('weather-content');
            if (!realTimeData.weatherData) {
                weatherContent.innerHTML = '<p class="text-slate-500 dark:text-slate-400 text-center">Weather data unavailable</p>';
                return;
            }
            
            const weather = realTimeData.weatherData;
            weatherContent.innerHTML = `
                <div class="text-center mb-4">
                    <div class="text-3xl font-bold text-slate-800 dark:text-slate-100 mb-2">${weather.temperature}°C</div>
                    <div class="text-sm text-slate-600 dark:text-slate-300 capitalize">${weather.description}</div>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div class="text-center p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                        <div class="text-slate-500 dark:text-slate-400">Humidity</div>
                        <div class="font-semibold text-slate-800 dark:text-slate-100">${weather.humidity}%</div>
                    </div>
                    <div class="text-center p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg">
                        <div class="text-slate-500 dark:text-slate-400">Wind</div>
                        <div class="font-semibold text-slate-800 dark:text-slate-100">${weather.windSpeed} km/h</div>
                    </div>
                </div>
            `;
        }

        // Update last updated time
        function updateLastUpdatedTime() {
            const now = new Date();
            realTimeData.lastUpdate = now;
            document.getElementById('last-updated-time').textContent = 
                now.toLocaleTimeString();
        }

        // Show data error
        function showDataError(message) {
            const vesselsBody = document.getElementById('real-time-vessels-body');
            vesselsBody.innerHTML = `
                <tr>
                    <td colspan="4" class="px-4 py-8 text-center text-red-500 dark:text-red-400">
                        ${message}
                    </td>
                </tr>
            `;
        }

        function init() {
            setupDay(currentDay);
            
            ['27', '28', '29', '30', '1', '2'].forEach(day => {
                document.getElementById(`day${day}Btn`).addEventListener('click', () => setupDay(parseInt(day)));
            });

            document.getElementById('resetDataBtn').addEventListener('click', () => setupDay(currentDay));
            document.getElementById('runOptimizationBtn').addEventListener('click', startDailySimulation);
            document.getElementById('stopSimulationBtn').addEventListener('click', stopSimulation);

            // Modal close listeners
            document.getElementById('modal-close-btn').addEventListener('click', closeBerthHistoryModal);
            document.getElementById('modal-backdrop').addEventListener('click', closeBerthHistoryModal);
            
            // Initialize real-time data integration
            initRealTimeIntegration();
        }
        
        function setupDay(day) {
            // Stop any running simulation
            stopSimulation();
            
            currentDay = day;
            const month = (day >= 1 && day <= 2) ? 9 : 8;
            const year = 2025;
            simulationTime = new Date(year, month, day, 6, 0, 0);
            
            // Reset daily stats
            totalWaitTimeForDay = 0;
            totalTimeOptimizedForDay = 0;
            dailyStats = {
                totalWaitTime: 0,
                totalTimeOptimized: 0,
                vesselsBerthed: 0,
                vesselsWaiting: 0
            };
            
            // Initialize or preserve ongoing services
            if (!ongoingVesselServices) {
                ongoingVesselServices = {};
            }
            
            logActivity(`Simulation initialized for ${simulationTime.toLocaleDateString()}`, 'start');
            
            document.querySelectorAll('.date-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`day${day}Btn`).classList.add('active');

            setupInitialState();
            renderDashboard();
        }

        function setupInitialState() {
            vessels = [];
            berths = [];
            
            const dayData = portDataByDay[currentDay];
            
            // Initialize berths
            allBerthNames.forEach((name, index) => {
                const spec = berthSpecifications[name] || { loa: 200, draft: 12 };
                berths.push({ 
                    id: index + 1, 
                    name: name, 
                    loa: spec.loa, 
                    draft: spec.draft, 
                    isOccupied: false, 
                    occupiedBy: null, 
                    freeAfter: null,
                    currentVessel: null  // Track current vessel for one-vessel-per-berth rule
                });
                if (!berthHistory[name]) berthHistory[name] = [];
            });

            // Set up pre-berthed vessels - ENFORCING ONE VESSEL PER BERTH
            dayData.occupancy.forEach((occupiedBerthData, index) => {
                const berth = berths.find(b => b.name === occupiedBerthData.berthName);
                if (berth && !berth.isOccupied) {  // Only assign if berth is not already occupied
                    berth.isOccupied = true;
                    const vesselName = occupiedBerthData.vesselName;
                    
                    // Check if this vessel was already in service from previous day
                    let departureTime;
                    if (ongoingVesselServices[vesselName]) {
                        // Continue with existing service time
                        departureTime = ongoingVesselServices[vesselName];
                    } else {
                        // Create new service time
                        const serviceHours = 8 + Math.random() * 24;
                        departureTime = new Date(simulationTime.getTime() + serviceHours * 60 * 60 * 1000);
                        ongoingVesselServices[vesselName] = departureTime;
                    }
                    
                    const vessel = createVessel(vesselName, 50000);
                    vessel.id = `V-preberthed-${currentDay}-${index}`;
                    vessel.status = 'Berthed';
                    vessel.assignedBerthId = berth.id;
                    vessel.arrivalTime = new Date(simulationTime.getTime() - 8 * 60 * 60 * 1000);
                    vessel.berthingTime = new Date(simulationTime.getTime() - 7 * 60 * 60 * 1000);
                    vessel.departureTime = departureTime;

                    vessels.push(vessel);
                    berth.occupiedBy = vessel.id;
                    berth.freeAfter = departureTime;
                    berth.currentVessel = vessel;  // Track current vessel

                    const isAlreadyInHistory = berthHistory[berth.name].some(rec => 
                        rec.vesselName === vessel.name && rec.status === 'Berthed' && 
                        rec.berthingTime.getTime() === vessel.berthingTime.getTime()
                    );
                    if (!isAlreadyInHistory) {
                        berthHistory[berth.name].push({ 
                            vesselName: vessel.name, 
                            berthingTime: vessel.berthingTime, 
                            departureTime: vessel.departureTime, 
                            status: 'Berthed' 
                        });
                    }
                }
            });

            // Set up waiting vessels
            const waitingVesselsData = JSON.parse(JSON.stringify(dayData.waiting));
            waitingVesselsData.forEach((v, i) => {
                const newVessel = createVessel(v.name, v.tonnes);
                newVessel.id = `V-waiting-${currentDay}-${i}`;
                newVessel.arrivalTime = new Date(v.arrivalStr);
                vessels.push(newVessel);
            });
        }
        
        function createVessel(name, tonnes) {
            let size, loa, draft;
            if (tonnes < 20000) { 
                size = 'Small'; 
                loa = 100 + Math.random() * 60; 
                draft = 8 + Math.random() * 2; 
            } else if (tonnes < 80000) { 
                size = 'Medium'; 
                loa = 161 + Math.random() * 70; 
                draft = 10.1 + Math.random() * 3; 
            } else { 
                size = 'Large'; 
                loa = 231 + Math.random() * 70; 
                draft = 13.2 + Math.random() * 3; 
            }
            return { 
                name: name, 
                size: size, 
                loa: parseFloat(loa.toFixed(2)), 
                draft: parseFloat(draft.toFixed(2)), 
                berthingTime: null, 
                departureTime: null, 
                status: 'Waiting', 
                assignedBerthId: null 
            };
        }

        function startDailySimulation() {
            // Disable run button, enable stop button
            document.getElementById('runOptimizationBtn').classList.add('hidden');
            document.getElementById('stopSimulationBtn').classList.remove('hidden');
            
            logActivity(`Daily simulation started. Running for 24 hours...`, 'start');
            
            // Run simulation for 24 hours (24 steps of 1 hour each)
            let hoursSimulated = 0;
            const totalHours = 24;
            
            simulationInterval = setInterval(() => {
                if (hoursSimulated >= totalHours) {
                    stopSimulation();
                    logActivity(`Daily simulation completed. Total wait time: ${totalWaitTimeForDay.toFixed(2)} hours, Time optimized: ${totalTimeOptimizedForDay.toFixed(2)} hours`, 'completion');
                    return;
                }
                
                // Advance time by 1 hour
                simulationTime.setHours(simulationTime.getHours() + 1);
                runOptimization();
                renderDashboard();
                hoursSimulated++;
                
                // Update progress
                if (hoursSimulated % 6 === 0) { // Log every 6 hours
                    logActivity(`Simulation progress: ${hoursSimulated}/24 hours completed`, 'progress');
                }
            }, 1000); // Run every second for demo purposes
        }
        
        function stopSimulation() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
            }
            
            // Re-enable run button, disable stop button
            document.getElementById('runOptimizationBtn').classList.remove('hidden');
            document.getElementById('stopSimulationBtn').classList.add('hidden');
            
            logActivity(`Simulation stopped manually`, 'stop');
        }

        function runOptimization() {
            // Process departures - ENFORCING ONE VESSEL PER BERTH
            berths.forEach(b => {
                if (b.isOccupied && b.freeAfter && b.freeAfter <= simulationTime) {
                    const departedVessel = vessels.find(v => v.id === b.occupiedBy);
                    if (departedVessel) {
                        departedVessel.status = 'Departed';
                        logActivity(`<strong>${departedVessel.name}</strong> has departed from Berth <strong>${b.name}</strong> at ${simulationTime.toLocaleTimeString()}.`, 'departure');
                        
                        // Remove from ongoing services
                        delete ongoingVesselServices[departedVessel.name];
                        
                        const historyRecord = berthHistory[b.name]?.find(rec => 
                            rec.vesselName === departedVessel.name && 
                            rec.status === 'Berthed' &&
                            rec.berthingTime.getTime() === departedVessel.berthingTime.getTime()
                        );
                        if (historyRecord) {
                            historyRecord.status = 'Departed';
                            historyRecord.departureTime = new Date(simulationTime);
                        }
                    }
                    // Free the berth for new vessel
                    b.isOccupied = false; 
                    b.occupiedBy = null; 
                    b.freeAfter = null;
                    b.currentVessel = null;
                }
            });

            // Process waiting vessels - ENFORCING ONE VESSEL PER BERTH
            const vesselsToAssign = vessels.filter(v => v.status === 'Waiting' && v.arrivalTime <= simulationTime)
                                          .sort((a, b) => a.arrivalTime - b.arrivalTime);
            const availableBerths = berths.filter(b => !b.isOccupied);

            for (const vessel of vesselsToAssign) {
                let assignedBerth = null;
                
                // Find first compatible berth that is not occupied
                for (let i = 0; i < availableBerths.length; i++) {
                    if (isCompatible(vessel, availableBerths[i]) && !availableBerths[i].isOccupied) {
                        assignedBerth = availableBerths[i];
                        availableBerths.splice(i, 1);
                        break;
                    }
                }

                if (assignedBerth && !assignedBerth.isOccupied) {  // Double-check berth is not occupied
                    vessel.berthingTime = new Date(simulationTime);
                    const serviceDuration = (Math.floor(Math.random() * 8) + 4) * 60 * 60 * 1000;
                    vessel.departureTime = new Date(vessel.berthingTime.getTime() + serviceDuration);
                    vessel.status = 'Berthed';
                    vessel.assignedBerthId = assignedBerth.id;
                    
                    // Update berth state - ENFORCE ONE VESSEL PER BERTH
                    assignedBerth.isOccupied = true;
                    assignedBerth.occupiedBy = vessel.id;
                    assignedBerth.freeAfter = vessel.departureTime;
                    assignedBerth.currentVessel = vessel;

                    // Track ongoing service
                    ongoingVesselServices[vessel.name] = vessel.departureTime;

                    // Calculate wait time and add to daily total
                    const waitTimeHours = (vessel.berthingTime - vessel.arrivalTime) / (1000 * 60 * 60);
                    totalWaitTimeForDay += waitTimeHours;
                    
                    // Calculate time optimized - realistic calculation
                    const targetWaitTimeHours = 4;
                    const timeOptimized = Math.max(0, targetWaitTimeHours - waitTimeHours);
                    totalTimeOptimizedForDay += timeOptimized;

                    logActivity(`<strong>${vessel.name}</strong> berthed at <strong>${assignedBerth.name}</strong>. Wait time: ${waitTimeHours.toFixed(2)}h`, 'berthing');
                    berthHistory[assignedBerth.name].push({ 
                        vesselName: vessel.name, 
                        berthingTime: vessel.berthingTime, 
                        departureTime: vessel.departureTime, 
                        status: 'Berthed' 
                    });
                }
            }
        }
        
        function isCompatible(vessel, berth) { 
            return vessel.loa <= berth.loa && vessel.draft <= berth.draft; 
        }

        function logActivity(message, type) {
            activityLog.unshift({ timestamp: new Date(simulationTime), message, type });
            if (activityLog.length > 50) activityLog.pop();
        }

        //  UI RENDERING & INTERACTION
        function renderDashboard() {
            renderBerthGrid();
            renderWaitingList();
            renderAnalytics();
            renderAllotmentPlan();
            renderActivityLog();
        }

        function renderBerthGrid() {
            const grid = document.getElementById('berth-grid');
            grid.innerHTML = '';
            berths.sort((a,b)=> a.id - b.id).forEach(berth => {
                const isOccupied = berth.isOccupied;
                const vessel = isOccupied ? vessels.find(v => v.id === berth.occupiedBy) : null;
                const statusPill = isOccupied 
                    ? `<div class="text-xs font-bold uppercase tracking-wider text-red-800 bg-red-200 dark:text-red-200 dark:bg-red-800/50 px-2 py-1 rounded-full">Occupied</div>`
                    : `<div class="text-xs font-bold uppercase tracking-wider text-green-800 bg-green-200 dark:text-green-200 dark:bg-green-800/50 px-2 py-1 rounded-full">Available</div>`;
                const card = document.createElement('div');
                card.className = `glass-card-interactive p-4 rounded-xl flex flex-col justify-between min-h-[160px] bg-slate-50/50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 cursor-pointer`;
                card.addEventListener('click', () => openBerthHistoryModal(berth));
                let content = `
                    <div class="flex justify-between items-center">
                        <div class="font-bold text-lg text-slate-800 dark:text-slate-100">${berth.name}</div>
                        ${statusPill}
                    </div>
                    <div class="text-sm text-slate-600 dark:text-slate-300 mt-1">
                        LOA: ${berth.loa}m | Draft: ${berth.draft}m
                    </div>`;
                if (isOccupied && vessel) {
                    content += `<div class="mt-3 pt-3 border-t border-slate-200 dark:border-slate-700">
                        <div class="text-sm font-semibold text-indigo-600 dark:text-indigo-400 truncate">${vessel.name}</div>
                        <div class="text-xs text-slate-600 dark:text-slate-300 mt-1">
                            Free: ${berth.freeAfter.toLocaleString([], { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' })}
                        </div>
                    </div>`;
                }
                card.innerHTML = content;
                grid.appendChild(card);
            });
        }
        
        function renderActivityLog() {
            const logContainer = document.getElementById('activity-log');
            logContainer.innerHTML = '';
            if (activityLog.length === 0) {
                logContainer.innerHTML = `<p class="text-sm text-slate-600 dark:text-slate-400 text-center py-4">No activity yet.</p>`;
                return;
            }
            const iconMap = {
                berthing: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414l-3-3z" clip-rule="evenodd" /></svg>`,
                departure: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414l-3-3z" clip-rule="evenodd" transform="rotate(180 10 10)"/></svg>`,
                start: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.415L11 9.586V6z" clip-rule="evenodd" /></svg>`,
                progress: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd" /></svg>`,
                completion: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>`,
                stop: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd" /></svg>`
            };
            activityLog.forEach(item => {
                const logItem = document.createElement('div');
                logItem.className = 'flex items-start gap-3';
                logItem.innerHTML = `
                    <div class="flex-shrink-0 pt-1">${iconMap[item.type] || ''}</div>
                    <div>
                        <p class="text-sm text-slate-800 dark:text-slate-200">${item.message}</p>
                        <p class="text-xs text-slate-600 dark:text-slate-400">${item.timestamp.toLocaleTimeString()}</p>
                    </div>`;
                logContainer.appendChild(logItem);
            });
        }

        function openBerthHistoryModal(berth) {
            const modal = document.getElementById('berth-history-modal');
            document.getElementById('modal-title').textContent = `Berth ${berth.name} - Service History`;
            const list = document.getElementById('modal-history-list');
            list.innerHTML = '';
            const history = berthHistory[berth.name] || [];

            if (history.length === 0) {
                list.innerHTML = `<li class="text-center text-slate-600 dark:text-slate-400 py-6">No service history recorded for this berth.</li>`;
            } else {
                [...history].reverse().forEach(record => {
                    const item = document.createElement('li');
                    item.className = 'p-4 bg-slate-100 dark:bg-slate-800/50 rounded-lg';
                    const statusPill = record.status === 'Berthed'
                        ? `<span class="px-2 py-1 text-xs font-semibold text-green-800 bg-green-200 dark:text-green-100 dark:bg-green-500/50 rounded-full">Active</span>`
                        : `<span class="px-2 py-1 text-xs font-semibold text-slate-600 bg-slate-200 dark:text-slate-300 dark:bg-slate-600/50 rounded-full">Departed</span>`;
                    item.innerHTML = `
                        <div class="flex justify-between items-center">
                            <p class="font-bold text-lg text-indigo-600 dark:text-indigo-400">${record.vesselName}</p>
                            ${statusPill}
                        </div>
                        <div class="text-xs text-slate-600 dark:text-slate-300 mt-2 grid grid-cols-2 gap-2">
                           <p><strong>Berthed:</strong> ${record.berthingTime.toLocaleString()}</p>
                           <p><strong>Departure:</strong> ${record.departureTime.toLocaleString()}</p>
                        </div>`;
                    list.appendChild(item);
                });
            }

            modal.classList.remove('modal-hidden');
            modal.style.display = 'flex';
            setTimeout(() => { 
                modal.style.opacity = 1;
                modal.querySelector('.glass-card').style.transform = 'scale(1)';
            }, 10);
        }

        function closeBerthHistoryModal() {
            const modal = document.getElementById('berth-history-modal');
            modal.style.opacity = 0;
            modal.querySelector('.glass-card').style.transform = 'scale(0.95)';
            setTimeout(() => {
                modal.style.display = 'none';
                modal.classList.add('modal-hidden');
            }, 300);
        }

        function renderWaitingList(){
            const e=document.getElementById("waiting-vessels-list");
            e.innerHTML="";
            const t=vessels.filter(e=>"Waiting"===e.status).sort((e,t)=>e.arrivalTime-t.arrivalTime);
            if(0===t.length){
                e.innerHTML='<p class="text-sm text-slate-600 dark:text-slate-400 text-center py-4">No vessels are currently waiting.</p>';
                return
            }
            t.forEach(t=>{
                const s=document.createElement("div");
                s.className="p-3 bg-slate-100 dark:bg-slate-800/50 rounded-lg",
                s.innerHTML=`
                <div class="flex justify-between items-center">
                    <p class="font-semibold text-slate-800 dark:text-slate-200">${t.name}</p>
                    <span class="text-xs font-medium text-amber-600 dark:text-amber-400">Waiting</span>
                </div>
                <p class="text-xs text-slate-600 dark:text-slate-400 mt-1">
                    Arrival: ${t.arrivalTime.toLocaleString()}
                </p>`,
                e.appendChild(s)
            })
        }

        function renderAnalytics(){
            const e=document.getElementById("analytics-content"),
            t=vessels.filter(e=>"Berthed"===e.status).length,
            s=vessels.filter(e=>"Waiting"===e.status).length;
            
            e.innerHTML=`
            <div class="flex items-start gap-4">
                <div class="flex-shrink-0 w-10 h-10 bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 rounded-lg flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
                </div>
                <div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Vessels Berthed</p>
                    <p class="text-2xl font-bold text-slate-800 dark:text-slate-100">${t}</p>
                </div>
            </div>
            <div class="flex items-start gap-4">
                <div class="flex-shrink-0 w-10 h-10 bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400 rounded-lg flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                </div>
                <div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Vessels Waiting</p>
                    <p class="text-2xl font-bold text-slate-800 dark:text-slate-100">${s}</p>
                </div>
            </div>
            <div class="flex items-start gap-4 pt-2 mt-2 border-t border-slate-200 dark:border-slate-700">
                <div class="flex-shrink-0 w-10 h-10 bg-red-100 dark:bg-red-900/50 text-red-600 dark:text-red-400 rounded-lg flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                </div>
                <div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Total Wait Time (Cost)</p>
                    <p class="text-2xl font-bold text-red-600 dark:text-red-400">${totalWaitTimeForDay.toFixed(2)} <span class="text-lg font-medium">hours</span></p>
                </div>
            </div>
            <div class="flex items-start gap-4 pt-2">
                <div class="flex-shrink-0 w-10 h-10 bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 rounded-lg flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>
                </div>
                <div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Total Time Optimized</p>
                    <p class="text-2xl font-bold text-green-600 dark:text-green-400">${totalTimeOptimizedForDay.toFixed(2)} <span class="text-lg font-medium">hours</span></p>
                </div>
            </div>
            <p class="text-xs text-center text-slate-600 dark:text-slate-400 pt-2">Sim Time: ${simulationTime.toLocaleString()}</p>`
        }

        function renderAllotmentPlan(){
            const e=document.getElementById("allotment-plan-body");
            e.innerHTML="";
            const t=vessels.filter(e=>"Berthed"===e.status&&e.id&&e.id.startsWith(`V-waiting-${currentDay}`)).sort((e,t)=>e.berthingTime-t.berthingTime);
            if(0===t.length){
                e.innerHTML='<tr><td colspan="5" class="text-center text-slate-600 dark:text-slate-400 py-8">Run optimization to generate an allotment plan.</td></tr>';
                return
            }
            t.forEach(t=>{
                const s=berths.find(e=>e.id===t.assignedBerthId),
                l=(Math.max(0,t.berthingTime-t.arrivalTime)/36e5).toFixed(2),
                n=document.createElement("tr");
                n.className="border-b border-slate-200 dark:border-slate-700",
                n.innerHTML=`
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-800 dark:text-slate-100">${t.name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300">${s?s.name:"N/A"}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300">${t.arrivalTime.toLocaleString()}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300">${t.berthingTime.toLocaleString()}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-red-600 dark:text-red-400">${l} hours</td>
                `,
                e.appendChild(n)
            })
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>